# Реестр транзакций Saga-оркестрации

## Таблица транзакций

| Транзакция              | Описание                                                                                                                   | Тип            | Компенсация     |
| ----------------------- | -------------------------------------------------------------------------------------------------------------------------- | -------------- | --------------- |
| INITIATE_PAYMENT        | Инициирует платеж: создает запись о заказе в системе, генерирует paymentId. Идемпотентно по запросу.                       | повторяемая    | -               |
| CHARGE_CUSTOMER         | Списывает средства с счета клиента. Использует внешние API с retry.                                                        | компенсируемая | REFUND_CUSTOMER |
| REFUND_CUSTOMER         | Возвращает средства клиенту при блокировке или сбое (автоматически).                                                       | необратимая    | -               |
| PERFORM_ANTIFRAUD_CHECK | Выполняет антифрод-проверку (внутренняя + внешние сервисы, включая AML). Ожидает ответ (разрешение/запрет/ручная/таймаут). | компенсируемая | REVERT_STATUS   |
| REVERT_STATUS           | Откатывает статусы транзакции в БД (Redis/PostgreSQL) при компенсации.                                                     | повторяемая    | -               |
| CREDIT_MERCHANT          | Переводятся деньги на счёт контрагенту после успешной антифрод-проверки                                                    | компенсируемая | REFUND_CUSTOMER |
| HANDLE_MANUAL_FRAUD     | Обрабатывает ручную проверку (ожидание 20 мин или cut-off-time для default approve).                                       | повторяемая    | REVERT_STATUS   |
| NOTIFY_CUSTOMER         | Отправляет уведомление клиенту о статусе (успех/отказ/ожидание).                                                           | повторяемая    | -               |
| NOTIFY_SECURITY         | Уведомляет систему безопасности при подозрении (фрод/ручная проверка).                                                     | повторяемая    | -               |
